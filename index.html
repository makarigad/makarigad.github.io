<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Makari Gad Hydroelectric Project | 10MW</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .tech-table td { padding: 0.75rem; border-bottom: 1px solid #e2e8f0; }
    .tech-table tr:last-child td { border-bottom: none; }
    .tech-table .label { font-weight: 500; color: #475569; width: 40%; }
    .tech-table .value { color: #1e293b; font-weight: 600; }

    .plant-card { position: fixed; right: 18px; bottom: 18px; z-index: 60; width: 260px; }

    /* SCADA Widget Styling */
    .scada-widget { 
        position: fixed; 
        left: 18px; 
        bottom: 18px; 
        z-index: 70; 
        width: 360px; 
        transition: all 0.3s ease-in-out;
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        max-height: 80vh; /* Allow scrolling on small screens */
    }
    
    .scada-widget.minimized {
        width: auto;
        height: auto;
        border-radius: 9999px;
        max-height: none;
    }
    
    .scada-widget.minimized .widget-content {
        display: none;
    }
    
    .scada-widget.minimized .widget-header {
        border-bottom: none;
        padding: 12px 20px;
        background: #4f46e5;
        color: white;
        cursor: pointer;
    }

    /* Live Status Dot Animation */
    .live-dot {
        height: 8px; width: 8px; background-color: #22c55e; border-radius: 50%; display: inline-block;
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7);
        animation: pulse-green 2s infinite;
    }
    @keyframes pulse-green {
        0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
        70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
        100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
    }

    @media (max-width: 640px) {
      .plant-card { left: 12px; right: 12px; width: auto; bottom: 12px; }
      .scada-widget { left: 12px; right: 12px; width: auto; bottom: 80px; }
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-900 flex flex-col min-h-screen">

  <nav class="bg-white sticky top-0 z-50 shadow-sm border-b border-slate-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex">
          <div class="flex-shrink-0 flex items-center">
            <a href="index.html" class="text-xl font-bold text-indigo-900 tracking-tight">Makari Gad</a>
          </div>
          <div class="hidden sm:ml-8 sm:flex sm:space-x-4 items-center">
            <a href="index.html" class="text-slate-900 font-medium px-3 py-2 rounded-md hover:text-indigo-600 text-sm">Home</a>
            
            <div class="relative group h-full flex items-center">
                <button class="text-slate-500 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium flex items-center gap-1">
                    Reports
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div class="absolute left-0 top-14 w-56 bg-white border border-slate-100 shadow-lg rounded-md overflow-hidden hidden group-hover:block">
                    <a href="daily-report.html" class="block px-4 py-3 text-sm text-slate-700 hover:bg-indigo-50 hover:text-indigo-700">Daily Report</a>
                    <a href="monthly-data-report.html" class="block px-4 py-3 text-sm text-slate-700 hover:bg-indigo-50 hover:text-indigo-700">Monthly Report</a>
                    <a href="energy-summary.html" class="block px-4 py-3 text-sm text-slate-700 hover:bg-indigo-50 hover:text-indigo-700">Energy Summary</a>
                </div>
            </div>

            <a href="plant-data.html" id="nav-data-entry" class="hidden text-slate-500 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Data Entry</a>
            <a href="#contact" class="text-slate-500 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Contact</a>
          </div>
        </div>

        <div class="flex items-center gap-4" id="header-auth-placeholder">
           <button onclick="document.getElementById('login-modal').classList.remove('hidden')" class="px-4 py-2 rounded-full bg-indigo-600 text-white text-sm font-medium hover:bg-indigo-700 transition shadow-md shadow-indigo-200">
             Sign in
           </button>
        </div>
        
        <div class="-mr-2 flex items-center sm:hidden">
          <button type="button" onclick="document.getElementById('mobile-menu').classList.toggle('hidden')" class="bg-white inline-flex items-center justify-center p-2 rounded-md text-slate-400 hover:text-slate-500 hover:bg-slate-100 focus:outline-none">
            <span class="sr-only">Open main menu</span>
            <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <div class="hidden sm:hidden border-t border-slate-200 bg-slate-50" id="mobile-menu">
      <div class="pt-2 pb-3 space-y-1">
        <a href="index.html" class="bg-indigo-50 border-l-4 border-indigo-500 text-indigo-700 block pl-3 pr-4 py-2 text-base font-medium">Home</a>
        <a href="daily-report.html" class="border-transparent text-slate-500 hover:bg-slate-50 hover:border-slate-300 hover:text-slate-700 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">Daily Report</a>
        <a href="monthly-data-report.html" class="border-transparent text-slate-500 hover:bg-slate-50 hover:border-slate-300 hover:text-slate-700 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">Monthly Report</a>
        <a href="energy-summary.html" class="border-transparent text-slate-500 hover:bg-slate-50 hover:border-slate-300 hover:text-slate-700 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">Energy Summary</a>
        <a href="plant-data.html" class="border-transparent text-slate-500 hover:bg-slate-50 hover:border-slate-300 hover:text-slate-700 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">Data Entry</a>
      </div>
    </div>
  </nav>

  <main class="flex-grow">
    <section class="relative bg-gradient-to-br from-indigo-900 to-slate-800 text-white overflow-hidden py-16 sm:py-24">
      <div class="absolute top-0 left-0 w-full h-full opacity-20 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
      
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 grid lg:grid-cols-2 gap-12 items-center">
        <div>
          <div class="inline-block px-3 py-1 mb-4 text-xs font-semibold tracking-wider text-indigo-200 uppercase bg-indigo-800/50 rounded-full border border-indigo-700">
            Darchula, Nepal
          </div>
          <h1 class="text-4xl sm:text-5xl font-extrabold tracking-tight leading-tight">
            Powering progress with <span class="text-indigo-400">clean energy</span>
          </h1>
          <p class="mt-6 text-lg text-indigo-100 max-w-lg">
            A 10 MW run-of-river project on the Makari Gad river, operational since March 2023.
          </p>
          <div class="mt-8 flex flex-wrap gap-4">
            <a href="daily-report.html" class="px-6 py-3 rounded-md bg-white text-indigo-900 font-bold hover:bg-indigo-50 transition">View Daily Report</a>
            <button onclick="toggleScadaWidget(true)" class="px-6 py-3 rounded-md bg-rose-600 text-white font-bold hover:bg-rose-700 transition flex items-center gap-2">
                <span class="relative flex h-3 w-3">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-3 w-3 bg-white"></span>
                </span>
                Live SCADA
            </button>
            <a href="#specs" class="px-6 py-3 rounded-md border border-indigo-400 text-indigo-100 font-medium hover:bg-indigo-800/50 transition">Technical Data</a>
          </div>
        </div>

        <div class="glass-card text-slate-800 rounded-2xl shadow-2xl p-6 sm:p-8 transform transition hover:scale-[1.01] duration-300">
          <div class="flex items-center justify-between mb-6 border-b border-slate-100 pb-4">
            <h3 class="text-xl font-bold text-slate-800 flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
              Site Snapshot
            </h3>
            <span id="card-update" class="text-xs font-mono text-slate-400 bg-slate-100 px-2 py-1 rounded">Loading...</span>
          </div>
          
          <div class="grid grid-cols-2 gap-6">
            <div class="p-4 bg-indigo-50 rounded-xl border border-indigo-100">
              <div class="text-xs font-semibold text-indigo-500 uppercase tracking-wide">Yesterday Energy</div>
              <div id="card-export" class="mt-1 text-2xl sm:text-3xl font-bold text-indigo-900">â€” kWh</div>
            </div>
            <div class="p-4 bg-emerald-50 rounded-xl border border-emerald-100">
              <div class="text-xs font-semibold text-emerald-600 uppercase tracking-wide">Availability</div>
              <div id="card-avail" class="mt-1 text-2xl sm:text-3xl font-bold text-emerald-900">â€” %</div>
            </div>
            <div class="col-span-2 flex gap-4">
              <div class="flex-1 p-3 bg-slate-50 rounded-lg border border-slate-200">
                <div class="text-xs text-slate-500">Outages</div>
                <div id="card-outages" class="font-semibold text-slate-700">â€”</div>
              </div>
              <div class="flex-1 p-3 bg-slate-50 rounded-lg border border-slate-200">
                <div class="text-xs text-slate-500">Plant Factor</div>
                <div class="font-semibold text-slate-700">â€”</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="about" class="py-16 bg-white">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-3xl font-bold text-slate-900 mb-6">About the Project</h2>
        <div class="prose prose-slate text-slate-600 text-justify space-y-4">
          <p>Makari Gad Hydropower Limited (MGHL) is the proponent of the Makari Gad Hydroelectric Project. The project is a <strong>10 MW run-of-river scheme</strong> located in Apihimal Rural Municipality, Darchula District. Construction was completed and the plant was commissioned on <strong>March 11, 2023</strong>.</p>
        </div>
      </div>
    </section>

    <section id="specs" class="py-16 bg-slate-50 border-y border-slate-200">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-10">
          <h2 class="text-3xl font-bold text-slate-900">Technical Specifications</h2>
          <p class="text-slate-500 mt-2">Key engineering parameters of the plant.</p>
        </div>
        <div class="grid md:grid-cols-2 gap-8 text-sm">
          <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
            <h3 class="text-lg font-bold text-indigo-700 mb-4 border-b pb-2">General & Hydrology</h3>
            <table class="w-full tech-table">
              <tr><td class="label">Type of Scheme</td><td class="value">Run-of-River</td></tr>
              <tr><td class="label">Gross Head</td><td class="value">891.63 m</td></tr>
              <tr><td class="label">Net Head</td><td class="value">862.35 m</td></tr>
              <tr><td class="label">Installed Capacity</td><td class="value">10 MW</td></tr>
              <tr><td class="label">Annual Generation</td><td class="value">71.8 GWh</td></tr>
            </table>
          </div>
          <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
            <h3 class="text-lg font-bold text-indigo-700 mb-4 border-b pb-2">Electro-Mechanical</h3>
            <table class="w-full tech-table">
              <tr><td class="label">Turbine Type</td><td class="value">Pelton (Horizontal)</td></tr>
              <tr><td class="label">No. of Units</td><td class="value">2 units (5.21 MW each)</td></tr>
              <tr><td class="label">Gen. Voltage</td><td class="value">6.6 kV</td></tr>
              <tr><td class="label">Transmission</td><td class="value">33 kV (27.2 km length)</td></tr>
            </table>
          </div>
        </div>
      </div>
    </section>

    <section id="board" class="py-16 bg-white">
      <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-3xl font-bold text-slate-900 mb-8 text-center">Board of Directors</h2>
        <div class="bg-white rounded-lg shadow border border-slate-200 overflow-hidden">
          <table class="min-w-full divide-y divide-slate-200">
            <tbody class="bg-white divide-y divide-slate-200 text-sm">
              <tr><td class="px-6 py-4 font-medium text-slate-900">Mr. Dammika Ajith Jayatilake Nanayakkara</td><td class="px-6 py-4 text-indigo-600 font-semibold">Director / Chairman</td></tr>
              <tr class="bg-slate-50/50"><td class="px-6 py-4 text-slate-700">Mr. Sameera Ganeegoda</td><td class="px-6 py-4 text-slate-600">Director</td></tr>
              <tr><td class="px-6 py-4 text-slate-700">Mr. Palitha Indigahawela Gamage Janaka</td><td class="px-6 py-4 text-slate-600">Director</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="py-16 bg-slate-50 border-t border-slate-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid lg:grid-cols-2 gap-12">
        <div id="notices">
          <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-2">ðŸ“¢ Notices</h2>
          <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-yellow-400">
             <p class="text-slate-600">There are no new notices at this time.</p>
          </div>
        </div>
        <div id="contact">
          <h2 class="text-2xl font-bold text-slate-900 mb-6">Contact Us</h2>
          <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
            <div class="mb-6 text-sm text-slate-600 space-y-2">
              <p><strong class="text-slate-800">Head Office:</strong> Maharajgunj, Kathmandu | +977-1-4720530</p>
              <p><strong class="text-slate-800">Email:</strong> makarigad@gmail.com</p>
            </div>
            <form id="contact-form" class="space-y-3">
              <input type="email" name="visitor_email" required placeholder="Your Email" class="w-full p-2.5 border border-slate-300 rounded text-sm" />
              <textarea name="message" required placeholder="Message" rows="3" class="w-full p-2.5 border border-slate-300 rounded text-sm"></textarea>
              <button type="submit" id="submit-btn" class="w-full py-2.5 bg-indigo-600 text-white rounded font-medium hover:bg-indigo-700 transition">Send Message</button>
            </form>
            <p id="form-status" class="text-center text-sm mt-3 font-medium"></p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div id="plant-card" class="plant-card hidden">
    <div class="glass-card p-4 rounded-lg shadow-lg">
      <div class="flex items-start justify-between gap-3">
        <div>
          <div class="text-xs text-slate-500">Operator</div>
          <div id="plant-card-email" class="text-sm font-semibold text-slate-800">â€”</div>
        </div>
        <div class="flex flex-col items-end gap-2">
          <a href="plant-data.html" class="px-3 py-1 rounded-md bg-emerald-500 text-white text-sm">Open Plant</a>
          <button id="close-plant-card" class="text-xs text-slate-400">Hide</button>
        </div>
      </div>
    </div>
  </div>

  <div id="scada-widget" class="scada-widget minimized bg-white rounded-t-lg shadow-2xl border border-slate-200 overflow-hidden">
    <div class="widget-header flex justify-between items-center bg-gray-50 border-b border-gray-200 p-3" onclick="toggleScadaWidget()">
        <div class="flex items-center gap-2">
            <span class="live-dot"></span>
            <span class="font-bold text-sm text-gray-800 header-text">Live Plant Status</span>
        </div>
        <button class="text-gray-400 hover:text-gray-600 transition" aria-label="Minimize Widget">
            <svg id="widget-toggle-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>
        </button>
    </div>
    
    <div class="widget-content bg-slate-50 p-4 overflow-y-auto">
        <div id="scada-status" class="mb-3 text-xs text-center text-slate-500">Connecting via proxy...</div>

        <div class="bg-indigo-600 text-white p-3 rounded-lg shadow-md text-center mb-3">
            <div class="text-[10px] uppercase font-bold tracking-wider opacity-80">Active Power</div>
            <div class="text-2xl font-bold mt-1" id="scada-power">--</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
            <div class="bg-white p-2.5 rounded border border-slate-200 shadow-sm text-center">
                <div class="text-[10px] uppercase text-slate-500 font-semibold tracking-wider">Control Mode</div>
                <div class="text-sm font-bold text-slate-700 mt-1" id="scada-control">--</div>
            </div>
            <div class="bg-white p-2.5 rounded border border-slate-200 shadow-sm text-center">
                <div class="text-[10px] uppercase text-slate-500 font-semibold tracking-wider">Water Level</div>
                <div class="text-sm font-bold text-blue-600 mt-1" id="scada-level">--</div>
                <div class="text-[10px] text-slate-400">cm</div>
            </div>
            <div class="bg-white p-2.5 rounded border border-slate-200 shadow-sm text-center">
                <div class="text-[10px] uppercase text-slate-500 font-semibold tracking-wider">Energy Total</div>
                <div class="text-sm font-bold text-slate-700 mt-1" id="scada-total">--</div>
                <div class="text-[10px] text-slate-400">MWh</div>
            </div>
            <div class="bg-white p-2.5 rounded border border-slate-200 shadow-sm text-center">
                <div class="text-[10px] uppercase text-slate-500 font-semibold tracking-wider">Energy Month</div>
                <div class="text-sm font-bold text-slate-700 mt-1" id="scada-month">--</div>
                <div class="text-[10px] text-slate-400">MWh</div>
            </div>
            <div class="bg-white p-2.5 rounded border border-slate-200 shadow-sm text-center">
                <div class="text-[10px] uppercase text-slate-500 font-semibold tracking-wider">Last Month</div>
                <div class="text-sm font-bold text-slate-500 mt-1" id="scada-last-month">--</div>
                <div class="text-[10px] text-slate-400">MWh</div>
            </div>
            <div class="bg-white p-2.5 rounded border border-slate-200 shadow-sm text-center">
                <div class="text-[10px] uppercase text-slate-500 font-semibold tracking-wider">Energy Day</div>
                <div class="text-sm font-bold text-emerald-600 mt-1" id="scada-day">--</div>
                <div class="text-[10px] text-slate-400">MWh</div>
            </div>
            <div class="bg-white p-2.5 rounded border border-slate-200 shadow-sm text-center">
                <div class="text-[10px] uppercase text-slate-500 font-semibold tracking-wider">Yesterday</div>
                <div class="text-sm font-bold text-slate-500 mt-1" id="scada-yesterday">--</div>
                <div class="text-[10px] text-slate-400">MWh</div>
            </div>
            <div class="bg-white p-2.5 rounded border border-slate-200 shadow-sm text-center">
                <div class="text-[10px] uppercase text-slate-500 font-semibold tracking-wider">Reactive</div>
                <div class="text-sm font-bold text-slate-700 mt-1" id="scada-reactive">--</div>
                <div class="text-[10px] text-slate-400">kVar</div>
            </div>
        </div>
        
        <div class="mt-4 text-center">
            <a href="http://connect.wkv-ag.com:5013/wkv_start.html" target="_blank" rel="noopener noreferrer" class="text-xs text-indigo-500 hover:text-indigo-700 underline">
                View Full SCADA Interface
            </a>
        </div>
    </div>
  </div>

  <div id="login-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 z-[100] hidden flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-sm relative">
        <button onclick="document.getElementById('login-modal').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600" aria-label="Close Login Modal">âœ•</button>
        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Operator Login</h2>
        <form id="login-form" class="space-y-4">
            <div>
                <label for="login-email" class="block text-sm font-medium text-gray-700">Email</label>
                <input type="email" id="login-email" required placeholder="Enter your email" class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" />
            </div>
            <div>
                <label for="login-password" class="block text-sm font-medium text-gray-700">Password</label>
                <input type="password" id="login-password" required placeholder="Enter your password" class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" />
            </div>
            <div id="login-error" class="text-red-500 text-sm hidden"></div>
            <button type="submit" id="login-submit-btn" class="w-full py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-md transition">Sign In</button>
        </form>
    </div>
  </div>

  <div id="footer-placeholder"></div>

  <script>
    (function() { emailjs.init("jpMXuP9OTdOnO3zzs"); })();
    document.getElementById('contact-form').addEventListener('submit', function(event) {
        event.preventDefault();
        const btn = document.getElementById('submit-btn');
        btn.disabled = true; btn.textContent = 'Sending...';
        emailjs.sendForm('service_zgfpybr', 'template_djddxd8', this)
            .then(() => { btn.textContent = 'Sent'; setTimeout(() => { btn.disabled = false; btn.textContent = 'Send Message'; }, 3000); });
    });

    function toggleScadaWidget(forceOpen = false) {
        const widget = document.getElementById('scada-widget');
        const icon = document.getElementById('widget-toggle-icon');
        const headerText = widget.querySelector('.header-text');

        if (forceOpen || widget.classList.contains('minimized')) {
            widget.classList.remove('minimized');
            widget.classList.add('rounded-lg');
            widget.classList.remove('rounded-full');
            icon.setAttribute('d', 'M19 9l-7 7-7-7'); // Arrow down
            headerText.style.color = '#1f2937';
            widget.querySelector('.widget-header').style.background = '#f9fafb';
            widget.querySelector('.widget-header').style.color = 'inherit';
            
            // Trigger fetch on open
            fetchScadaData(); 

        } else {
            widget.classList.add('minimized');
            widget.classList.remove('rounded-lg');
            icon.setAttribute('d', 'M5 15l7-7 7 7'); // Arrow up
            widget.querySelector('.widget-header').style.background = ''; 
            widget.querySelector('.widget-header').style.color = '';
        }
    }

    /* SCADA FETCH WITH PROXY BRIDGE AND REAL IDs */
    async function fetchScadaData() {
        const statusEl = document.getElementById('scada-status');
        const targetUrl = 'http://connect.wkv-ag.com:5013/wkv_start.html';
        const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(targetUrl);
        
        statusEl.textContent = 'Updating...';
        
        try {
            const response = await fetch(proxyUrl);
            if (!response.ok) throw new Error('Network response was not ok');
            const text = await response.text();
            
            const parser = new DOMParser();
            const doc = parser.parseFromString(text, 'text/html');

            // --- IDs MAPPED FROM YOUR SCREENSHOTS ---
            const pwr = doc.querySelector('#txtGaugeMeterValue1')?.innerText || '--'; 
            const control = doc.querySelector('#txtDisplayValue1')?.innerText || '--';
            const lvl = doc.querySelector('#txtDisplayValue2')?.innerText || '--';
            const total = doc.querySelector('#txtDisplayValue3')?.innerText || '--';
            const month = doc.querySelector('#txtDisplayValue4')?.innerText || '--';
            const lastMonth = doc.querySelector('#txtDisplayValue5')?.innerText || '--';
            const day = doc.querySelector('#txtDisplayValue6')?.innerText || '--';
            const yesterday = doc.querySelector('#txtDisplayValue7')?.innerText || '--';
            const reactive = doc.querySelector('#txtDisplayValue8')?.innerText || '--';

            document.getElementById('scada-power').textContent = pwr;
            document.getElementById('scada-control').textContent = control;
            document.getElementById('scada-level').textContent = lvl;
            document.getElementById('scada-total').textContent = total;
            document.getElementById('scada-month').textContent = month;
            document.getElementById('scada-last-month').textContent = lastMonth;
            document.getElementById('scada-day').textContent = day;
            document.getElementById('scada-yesterday').textContent = yesterday;
            document.getElementById('scada-reactive').textContent = reactive;
            
            statusEl.textContent = 'Live (via Proxy)';
            statusEl.className = 'mb-3 text-xs text-center text-green-600 font-bold';

        } catch (err) {
            console.warn('SCADA Fetch Error:', err);
            statusEl.innerHTML = `<span class="text-red-500">Connection Failed</span>`;
        }
    }

    // Auto-refresh every 30 seconds if open
    setInterval(() => {
        if (!document.getElementById('scada-widget').classList.contains('minimized')) {
            fetchScadaData();
        }
    }, 30000);
  </script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
    import { getFirestore, collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB9yreNlyZw9DFiuGlwMAecaDkdwn5cxDY",
      authDomain: "makari-gad.firebaseapp.com",
      projectId: "makari-gad",
      storageBucket: "makari-gad.appspot.com",
      messagingSenderId: "724611254155",
      appId: "1:724611254155:web:79851f67861cee3f90918e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const loginModal = document.getElementById('login-modal');
    const loginForm = document.getElementById('login-form');
    const loginError = document.getElementById('login-error');
    const loginBtn = document.getElementById('login-submit-btn');

    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        
        loginBtn.disabled = true;
        loginBtn.textContent = 'Signing in...';
        loginError.classList.add('hidden');

        try {
            await signInWithEmailAndPassword(auth, email, password);
            loginModal.classList.add('hidden');
            loginForm.reset();
        } catch (error) {
            console.error(error);
            loginError.textContent = "Invalid email or password.";
            loginError.classList.remove('hidden');
        } finally {
            loginBtn.disabled = false;
            loginBtn.textContent = 'Sign In';
        }
    });

    const plantCard = document.getElementById('plant-card');
    const plantCardEmail = document.getElementById('plant-card-email');
    const navDataEntry = document.getElementById('nav-data-entry');
    const headerAuth = document.getElementById('header-auth-placeholder');

    window.logoutUser = () => { if (confirm('Logout?')) signOut(auth).then(()=> window.location.reload()); };

    onAuthStateChanged(auth, (user) => {
      if (user) {
        if(plantCard) {
            plantCard.classList.remove('hidden');
            plantCardEmail.textContent = user.email || '';
        }
        if(navDataEntry) navDataEntry.classList.remove('hidden');

        if(headerAuth) {
           headerAuth.innerHTML = `
             <div class="hidden sm:block text-right">
                <div class="text-xs text-slate-400">Operator</div>
                <div class="text-sm font-semibold text-slate-700">${user.email}</div>
             </div>
             <button onclick="logoutUser()" class="text-sm text-slate-500 hover:text-red-600 font-medium">Logout</button>
           `;
        }
      } else {
        if(plantCard) plantCard.classList.add('hidden');
        if(navDataEntry) navDataEntry.classList.add('hidden');

        if(headerAuth) {
           headerAuth.innerHTML = `
             <button onclick="document.getElementById('login-modal').classList.remove('hidden')" class="px-4 py-2 rounded-full bg-indigo-600 text-white text-sm font-medium hover:bg-indigo-700 transition shadow-md shadow-indigo-200">
               Sign in
             </button>
           `;
        }
      }
      loadPreview(); 
    });

    async function loadPreview() {
      try {
        const q = query(collection(db, 'plantData'), orderBy('date', 'desc'), limit(1));
        const snap = await getDocs(q);
        if (!snap.empty) {
          const d = snap.docs[0].data();
          document.getElementById('card-export').textContent = (d.exportSubstation != null ? d.exportSubstation : 'â€”') + ' kWh';
          let avail = 'â€”';
          if (d.runningHours != null) {
            const hrs = parseFloat(d.runningHours);
            avail = ((hrs / 24) * 100).toFixed(1) + ' %';
          }
          document.getElementById('card-avail').textContent = avail;
          document.getElementById('card-outages').textContent = d.outageHours ? d.outageHours + ' hrs' : 'None';
          document.getElementById('card-update').textContent = 'Last: ' + (d.nepali_date || 'Unknown');
        } else {
          document.getElementById('card-update').textContent = 'No data';
        }
      } catch (e) {
        console.warn('Preview load failed', e);
        document.getElementById('card-update').textContent = 'Offline';
      }
    }

    function loadComponent(elementId, filePath) {
      fetch(filePath).then(r => r.text()).then(data => {
        document.getElementById(elementId).innerHTML = data;
        if(elementId === 'footer-placeholder') {
             const yearSpan = document.getElementById('copyright-year');
             if(yearSpan) yearSpan.textContent = new Date().getFullYear();
        }
      });
    }
    loadComponent('footer-placeholder', 'footer.html');
  </script>
</body>
</html>